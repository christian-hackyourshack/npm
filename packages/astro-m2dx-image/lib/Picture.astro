---
import Picture from './PatchedPicture.astro';
import type { CallbackProps, PictureProps } from './types';
import { getHeight, getWidth, resolveSrc } from './utils';

export interface Props extends PictureProps {}

let { callback, ...props } = Astro.props as Props;
await resolveSrc(props);
callback && (await callback(props as CallbackProps));

props.width ??= getWidth(props) ?? 480;
props.height ??= getHeight(props) ?? props.width;
if (!props.widths || props.widths.length === 0) {
  props.widths = [props.width];
}
---

<Picture {...props} />
